<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Graph:Sin:Cos</title>
<style>
* { box-sizing: border-box; font: normal 2.8vw Arial, sans-serif; }
.panou {
  position:absolute;
  top: 20px;
  left: 50vw;
  width: 45vw;
  text-align: right;
}
#graph {
  position: absolute;
  top: 10px; left: 10px;
  width: calc(100% - 20px);
  border: 1px solid grey;
  box-sizing: border-box;
  border-radius: 8px;
}
.circle {
  position: absolute;
  border: 1px solid red;
  border-radius: 50%;
  box-sizing: border-box;
}
.line {
  position: absolute;
  border-top: thin dashed grey;
  border-left: thin dashed grey;
}
#radius { border-top: 2px solid red; transform-origin: top left; }
#xyCirc { background-color: rgba(200,0,0,.4); }
.bgLine {
  position: absolute;
  border-top: 2px solid #00c;
  border-left: 2px solid #080;
}
.txt {
  position: absolute; padding: 8px; color: #00c;
}
#yTxt { transform-origin: top left; transform: rotate(-90deg); color: #080; }
#angTxt { color: #a00; font-size: 4.2vw; }
</style>
</head>
<body>

<div id='graph'></div>
<div id='bgCirc' class='circle'></div>
<div id='xAxis' class='line'></div>
<div id='yAxis' class='line'></div>
<div id='xcos' class='line'></div>
<div id='ysin' class='line'></div>
<div id='xCos' class='bgLine'></div>
<div id='ySin' class='bgLine'></div>
<div id='radius' class='line'></div>
<div id='orig' class='circle'></div>
<div id='xTxt' class='txt'></div>
<div id='yTxt' class='txt'></div>
<div id='angTxt' class='txt'></div>
<div id='xyCirc' class='circle' draggable="true"></div>

<div class='panou'>
  <input type="radio" name="radOrDeg" onchange="chngRadDeg()" checked/>Rad
  <input type="radio" name="radOrDeg" onchange="chngRadDeg()" />Deg
  <input type="checkbox" id="chStepFive" onchange="chStep()" />Step
</div>

<script>
  var inRad = true, Step = 1, x0, y0, R, quoAng;
    
  function chngRadDeg() {
    let radioBut = document.getElementsByName('radOrDeg'), v = quoAng;
    if(radioBut[0].checked) {
      inRad = true;
      Step = chStepFive.checked ? 2 : 1;
      drawGraph(24*quoAng/360);
    }
    else {
      inRad = false;
      Step = chStepFive.checked ? 5 : 1;
      drawGraph(360*quoAng/24);
    }
  }
    
  function chStep() {
    if(inRad) Step = chStepFive.checked ? 2 : 1;
    else Step = chStepFive.checked ? 5 : 1;
    drawGraph(quoAng);
  }

const chStepFive = document.querySelector("#chStepFive");
  graph = document.querySelector("#graph"),
	bgCirc = document.querySelector("#bgCirc"),
  xAxis = document.querySelector("#xAxis"),
  yAxis = document.querySelector("#yAxis"),
  y_sin = document.querySelector("#ysin"),
  x_cos = document.querySelector("#xcos"),
  y_Sin = document.querySelector("#ySin"),
  x_Cos = document.querySelector("#xCos"),
  orig = document.querySelector("#orig"),
  radius = document.querySelector("#radius"),
  smRed = document.querySelector("#xyCirc"),
  xTxt = document.querySelector("#xTxt"),
  yTxt = document.querySelector("#yTxt"),
  angTxt = document.querySelector("#angTxt"),
  isZero = /\.?0+$/, maxDecimals = 4;

function getAngle(n) {
  if(!inRad) return n + '°';
  let m = 12;
  while(n%2==0 && m%2==0) { n /= 2; m /=2; }
  while(n%3==0 && m%3==0) { n /= 3; m /=3; }
  if(n == 0) return '0';
  if(n == 1) n = 'π';
  else if(n == -1) n = '-π';
  else n += 'π';
  if(m > 1) return `${n}/${m}`;
  return n;
}

function trigMime(a, sg, isSin) {
  let absA = Math.abs(a), v = sg.toFixed(4); if(!inRad) absA /=15;
  if(isZero.test(v)) v = v.replace(isZero,'');
    if(absA == 3 || absA == 9 || absA == 15 || absA == 21) return `${v} (${Math.sign(sg)<0?'-':''}√2/2)`;
    if(isSin) {
      if(absA == 2 || absA == 10 || absA == 14 || absA == 22) return `${v} (${Math.sign(sg)<0?'-':''}1/2)`;
      if(absA == 4 || absA == 8 || absA == 16 || absA == 20) return `${v} (${Math.sign(sg)<0?'-':''}√3/2)`;
    }
    else {
      if(absA == 4 || absA == 8 || absA == 16 || absA == 20) return `${v} (${Math.sign(sg)<0?'-':''}1/2)`;
      if(absA == 2 || absA == 10 || absA == 14 || absA == 22) return `${v} (${Math.sign(sg)<0?'-':''}√3/2)`;
    }
  return v;
}

function drawCircle(obj, cx,cy,r=false) {
  let s = obj.style;
  s.left = `${cx-r}px`;
  s.top = `${cy-r}px`;
  if(!r) return;
  s.width = `${r*2}px`;
  s.height = `${r*2}px`;
}
function drawLine(obj, x1,y1,x2,y2, ang=null) {
	let s = obj.style;
  if(x1 > x2) [x1,x2] = [x2,x1];
  if(y1 > y2) [y1,y2] = [y2,y1];
  s.left = `${x1}px`;
  s.top = `${y1}px`;
  s.width = `${x2-x1}px`;
  s.height = `${y2-y1}px`;
  if(ang) s.transform = `rotate(${ang}rad)`;
}

function drawText(obj, x, y, txt, Algn) {
  let s = obj.style;
  obj.innerText = txt;
  s.left = `${x}px`;
  s.top = `${y}px`;
  s.textAlign = Algn?'right':'left';
}

function drawGraph(quo) {
//try {
    let box = graph.getBoundingClientRect();
    if(box.width != box.height) graph.style.height = `${box.width}px`;
    x0 = box.x + box.width/2, y0 = box.y + box.width/2, R = box.width/2-30;
    
    quoAng = Math.round(quo/Step)*Step;
    
    let txtAng = quoAng, angMime = txtAng,
    Ang = inRad ?txtAng/12*Math.PI : txtAng*Math.PI/180,
    xCos = Math.cos(Ang), ySin = Math.sin(Ang),
    X = x0 + Math.round(R * xCos), Y = y0 - Math.round(R * ySin);

    //alert(`id=${graph.id}\nx=${box.x} y=${box.y}\nw=${box.width} h=${box.height}\nx0=${x0} y0=${y0} R=${R}`);
    
    drawCircle(bgCirc, x0, y0, R);
    drawCircle(orig, x0, y0, 10);
    drawLine(xAxis, box.x, y0, box.right, y0);
    drawLine(yAxis, x0, box.y, x0, box.y + box.width);

    drawLine(x_cos, x0, Y, X, Y);
    drawLine(y_sin, X, Y, X, y0);
    drawLine(x_Cos, x0, y0, X, y0);
    drawLine(y_Sin, x0, y0, x0, Y);

    drawCircle(smRed, X, Y, 20);
    drawLine(radius, x0, y0, x0+R, y0, (-Ang).toString());

    xTxt.style.width = `${R}px`; yTxt.style.width = `${R}px`;

    txtAng = getAngle(txtAng);
    let invAng = getAngle(quoAng - (inRad?24:360));

    drawText(xTxt, xCos>0? x0:x0-R, ySin>0? y0:y0-30,
      `cos(${txtAng}) = ${trigMime(angMime, xCos, false)}`, xCos<0);
    drawText(yTxt, xCos>0? x0-30:x0, ySin>0? y0:y0+R,
      `sin(${txtAng}) = ${trigMime(angMime, ySin, true)}`, ySin<0);

    drawText(angTxt, box.x+5, box.y, `Θ = ${txtAng} (${invAng})`, false);

//} catch(err) { alert(err.message); }
}

/*-------------------------- Drag ------------------------------*/
var offset = [0,0], isDown = false, isTouch;

function getOff(e) {
  if(e.touches) e = e.touches[0];
  return [ e.clientX, e.clientY ];
}

function startDrag(e) {
  isDown = true;
  smRed.style.backgroundColor = '#f00';
  if(e.touches) e = e.touches[0];
  offset = [ smRed.offsetLeft - e.clientX, smRed.offsetTop - e.clientY ];
  if(isTouch) navigator.vibrate(60);
}

function endDrag() {
  isDown = false;
  smRed.style.backgroundColor = '';
}

function drag(e) {
//try {
  if(!isDown) return;
  e.preventDefault();
  
  if(e.touches) e = e.touches[0];
  let dx = e.clientX, dy = e.clientY;
  
  smRed.style.left = `${dx + offset[0]}px`;
  smRed.style.top  = `${dy + offset[1]}px`;
  
  let ang = Math.atan((y0-dy)/(dx-x0)), div = inRad?12:180,
    angInp = Math.round(ang/Math.PI*div);

  if(dx<x0 && dy<y0) angInp += div;
  else if(dx<x0 && dy>y0) angInp += div;
  else if(dx>x0 && dy>y0) angInp += div*2;

  drawGraph(angInp);
//} catch(err) { alert(err.message); }
}

function init() {
  drawGraph(3);
  isTouch = ('ontouchstart' in window) || (navigator.msMaxTouchPoints > 0);
  window.addEventListener('resize', ()=>{ drawGraph(quoAng); });
//try {
  if(isTouch) {
    smRed.addEventListener('touchstart', startDrag, true);
    document.addEventListener('touchmove', drag, true);
    document.addEventListener('touchend', endDrag, true);
    //document.addEventListener('touchleave', endDrag, true);
    document.addEventListener('touchcancel', endDrag, true);
  }
  else {
    smRed.addEventListener('mousedown', startDrag, true);
    document.addEventListener('mouseup', endDrag, true);
    document.addEventListener('mousemove', drag, true);
    //document.addEventListener('mouseleave', endDrag, true);
  }
//} catch(err) { alert(err.message); }
}

document.addEventListener("DOMContentLoaded", init);
</script>
</body>
</html>
