<!DOCTYPE html>
<html>
<head>
<style>
input { font-size: 18pt; width: 40px; text-align: right; }
body { font-size: 18pt; font-family: Arial, sans-serif; }
div { border:1px solid lightgrey; padding:12px; background-color: lightyellow; margin-top: 10pt; }
.equations td { padding: 2px 10px; }
.equations td:nth-child(1) { border-right: thin solid orange; text-align: right; }
.equations td:nth-child(3) { border-left: thin solid orange; }
.equations { border-collapse: collapse; font: normal 12pt Arial, sans-serif; }
.equations tr:nth-child(odd) { background-color: #eef; }
.equations tr:hover { cursor: pointer; background-color: lightgrey; }

.Pnl { font: normal 12pt sans-serif; margin: 12px 0; background-color: #fff; }
.Pnl div {
	padding: 0 6px;
  border: thin solid lightgrey;
  border-radius: 4px;
  display: inline;
  outline: none;
}
.Pnl div:hover { cursor: pointer; background-color: #ff0; }
.expl { padding: 3px 2px; border: thin solid #66d; font-size: small; color:#66d; border-radius: 3px; }
.expl1 { padding: 3px 2px; border: thin solid #4a4; font-size: small; color:#4a4; border-radius: 3px; }

</style>
</head>

<body onload='solve()'>

<h2>Quadratic Function Solver:</h2>
  
  <input id="Coef_A" onChange="solve()">x<sup>2</sup>
  <input id="Coef_B" value="+5" onChange="solve()">x
  <input id="Coef_C" value="-14" onChange="solve()"> = 0
  <div id='result'></div>
  <canvas id="graph" width="600" height="600" style="border: 1px solid black;"></canvas>

<div class="Pnl"><div onclick="generateEquations(getRandEquation)">Generate</div> <div id="nEqu" contentEditable>10</div> random equations <div onclick="tggle(this)">without</div> factors and solutions <div onclick="generateEquations(getByCompletion)">or by completion</div>.</div>
<table id='outEqu' class="equations"></table>

<script>

  const Coef_A = document.getElementById('Coef_A'),
  		  Coef_B = document.getElementById('Coef_B'),
  		  Coef_C = document.getElementById('Coef_C'),
  		  canvas = document.getElementById('graph');
  var   xERROR = ''; //--- check input errors


  
/* =============== SOLVER ============ */

function solve() {

    /* ----- Get Coefficients ---- */

	xERROR = '';
    var a = getCoef(Coef_A, true); //--- 'true' means empty is allowed
    var b = getCoef(Coef_B, false);
    var c = getCoef(Coef_C, false);

	if(xERROR != '') { writeResult("ERROR:" + xERROR); return; }
    
 	/* ----- Get Solutions ---- */
        
    var solution1, solution2, isReal = true;
      	qx = b*b - 4*a*c; //--- factor under the Square Root: real or complex

	if(qx > 0) { //--- Equation has REAL roots/solutions
    	solution1 = (-b + Math.sqrt(qx))/(2*a),
    	solution2 = (-b - Math.sqrt(qx))/(2*a);
	}
    else { //--- Equation has COMPLEX roots/solutions
      isReal = false;
    	solution1 = "[complex]";
      solution2 = (-b/(2*a)) + "±" + Math.sqrt(-qx)/(2*a) + 'i';
	}
    
    // ---- Print the Results ----
    
    writeResult(`Coefficients: a=${a}, b=${b}, c=${c}\nSolutions: {${solution1}, ${solution2}}`);
    
    drawGraph(a, b, c, solution1, solution2, isReal);

}

function writeResult(txt) {
	document.getElementById('result').innerText = txt;
}

function getCoef(elem, empt) {
   var x = elem.value.trim();
   if(x=='' && !empt) { xERROR += "\nCoefficient can't be empty."; return 0; }
   if(x=='' || x=='+' || x=='-') return parseInt(x+'1');
   else if(isNaN(x)) { xERROR += "\nCoefficient is not a number."; return 0; }
   var res = parseInt(x);
   if(res == 0) { xERROR += "\nCoefficient can't be zero."; return 0; }
   if(!empt) elem.value = (res>0 ? "+" + res.toString(): res.toString());
   return res;
}



/* ================ GRAPH FUNCTION ================== */

function drawGraph(a, b, c, solution1, solution2, isReal) {

  var ctx = canvas.getContext('2d');
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  canvas.width = canvas.width;

/* -------- Draw the Grid ---------- */

var wid = parseInt(canvas.width), orig = wid/2, unit = 20;
ctx.beginPath();
ctx.strokeStyle = "#ddd";
for(var x=unit; x<wid; x+=unit) {
	ctx.moveTo(x, 0);
  ctx.lineTo(x, wid);
	ctx.moveTo(0, x);
  ctx.lineTo(wid, x);
}
ctx.stroke();
ctx.beginPath();
ctx.strokeStyle = "#000";
	ctx.moveTo(orig, 0);
  ctx.lineTo(orig, wid);
	ctx.moveTo(0, orig);
  ctx.lineTo(wid, orig);
  ctx.stroke();

ctx.font = "10px Arial";
var pnts = orig/unit-1;
for(var X = -pnts; X<=pnts; X+=2) {
	ctx.moveTo(orig + X*unit, orig-4);
  ctx.lineTo(orig + X*unit, orig+4);
	ctx.fillText(X,orig + X*unit + 4,orig+12);
    
  if(X != 0) {
    	ctx.moveTo(orig-4, orig - X*unit);
    	ctx.lineTo(orig+4, orig - X*unit);
		ctx.fillText(X,orig+4, orig - X*unit + 8);
  }
}
ctx.stroke();

/* ------- Draw Graph -------- */

//var a=1, b=-3, c=-4, solution1 = -1, solution2 = 4; //--- coefficients
ctx.beginPath(); ctx.lineWidth = 3; ctx.strokeStyle = "#00c";

for(var X=-pnts; X<=pnts; X+=1/unit) {
	var Y = a*X*X + b*X + c;
  if(X == -pnts) ctx.moveTo(orig + X*unit, orig - Y*unit);
  ctx.lineTo(orig + X*unit, orig - Y*unit);
}
ctx.stroke();

/* ------ Mark the Solutions/Roots ----- */

if(isReal) {
  ctx.beginPath();
  ctx.strokeStyle = "#F00"; ctx.fillStyle = "#fff";
  var radius = 4, X = solution1, Y = a*X*X + b*X + c;
  ctx.arc(orig + X*unit,orig - Y*unit,radius, 0, 2*Math.PI);
  ctx.fill(); ctx.stroke();
  ctx.beginPath();
  X = solution2, Y = a*X*X + b*X + c;
  ctx.arc(orig + X*unit,orig - Y*unit,radius, 0, 2*Math.PI);
  ctx.fill(); ctx.stroke();
}

ctx.font = "24px Arial"; ctx.fillStyle = "#c00";
ctx.fillText('{' + solution1 + ', ' + solution2 + '}',10, 28);
ctx.stroke();

}

/* ==================== Generate Quadratic ================== */

function isPrime(x) { if(x<0) x=-x; return (x == 4 || x == 6 || x == 8 || x == 9 || x == 10)?false:true; }
function divis(lmt,ac,a) {
	if(lmt<0) lmt = -lmt;
	for(var i=2; i<lmt; i++) if(i != a && ac % i == 0) return i;
  return 0;
}
function fract(x,y) {
	let sgn = (x*y < 0)?'-':'', intr = 0;
	if(x%y==0) return x/y;
    
	x = Math.abs(x); y = Math.abs(y);
	const primes = [2,3,5,7,11,13,17];
	for(var p of primes) while(x%p==0 && y%p==0) { x /= p; y /= p; }

  if(x > y) return `${sgn}${intr = Math.floor(x/y)}<sup>${x-intr*y}</sup>/<sub>${y}</sub><span class="expl">=${sgn}<sup>${x}</sup>/<sub>${y}</sub></span>`;

return `${sgn}<sup>${x}</sup>/<sub>${y}</sub>`;
}

function getRandEquation() {

  var rng = 20, hlf = Math.floor(rng/2), a, b, c, ac, f1, f2, eq = "x²";
  while(true){
  	a = Math.floor(Math.random()*rng) - hlf;
  	c = Math.floor(Math.random()*rng) - hlf;
      if(a==0 || c==0) continue;
      ac = a*c;
      if(isPrime(a) && isPrime(c)) { f1=ac; f2=1; b = f1+f2; break; }
  	
      f1 = divis(ac,ac,a);
      if(f1 == 0) { alert("Schucher!"); break; }
      f2 = ac/f1;
      b = f1+f2;
      if(b != 0) break;
  }

  if(a==-1) eq = '-' + eq;
  else if(a!=1) eq = a + eq;
  
  if(b==-1) eq += '-x';
  else if(b==1) eq += '+x';
  else if(b>0) eq += ('+' + b + 'x');
  else eq += (b+'x');
  
  if(c>0) eq += ('+'+c);
  else eq += c;

  return [eq+" = 0", '{'+f1+', '+f2+'}', '{'+fract(-f1,a)+', '+fract(-f2,a)+'}'];
}


function getByCompletion() {
  var rng = 10, hlf = Math.floor(rng/2), a, b, c, eq, eqX = "x²", coef = [];
  while(coef.length < 4) {
    var cf = Math.floor(Math.random()*rng) - hlf;
    if(cf == 0 || coef.includes(cf)) continue;
    coef.push(cf);
  }
  a = coef[0]*coef[2];
  b = coef[0]*coef[3] + coef[1]*coef[2];
  c = coef[1]*coef[3];

  if(a==-1) eq = '-' + eqX;
  else if(a!=1) eq = a + eqX;
  
  if(b==-1) eq += '-x';
  else if(b==1) eq += '+x';
  else if(b>0) eq += ('+' + b + 'x');
  else eq += (b+'x');
  
  if(c>0) eq += ('+'+c);
  else eq += c;
  
  //----------------------------------------------------------
  if(b/a==-1) eqX += '-x';
  else if(b/a==1) eqX += '+x';
  else if(b/a > 0) eqX += ('+' + fract(b,a) + 'x');
  else eqX += (fract(b,a)+'x');
  
  eqX += (c/a > 0 ? '+':'') + fract(c,a);
  eqX += ' <span class="expl1">add ' + fract(b*b,4*a*a) + '</span>';

  return [eq+" = 0", eqX, '{'+ fract(-coef[1],coef[0]) +', '+ fract(-coef[3], coef[2]) +'}'];
}

const outEqu = document.getElementById('outEqu'),
nEqu = document.getElementById('nEqu');
var wSol = false;

function generateEquations(fnc) {
	var n = parseInt(nEqu.innerText), R, C, sol;
  if(isNaN(n) || n<1) return;

  const T = outEqu;
  while(T.rows.length) T.deleteRow(0);

  R = T.insertRow(-1);
    C = document.createElement("TH"); C.innerText = '#'; R.appendChild(C);
    C = document.createElement("TH"); C.innerText = 'Equation'; R.appendChild(C);
    if(wSol) {
      C = document.createElement("TH"); C.innerText = (fnc==getRandEquation)?'Factors':'Completion'; R.appendChild(C);
      C = document.createElement("TH"); C.innerText = 'Solutions'; R.appendChild(C);
    }

  for(var i=0; i<n; i++) {
    R = T.insertRow(-1);
    sol = fnc();

    R.insertCell(-1).innerText = (i+1)+'.';
    R.insertCell(-1).innerText = sol[0];
    if(wSol) {
      R.insertCell(-1).innerHTML =  sol[1];
      R.insertCell(-1).innerHTML = sol[2];
    }
  }
}

function tggle(el) { el.innerText = (el.innerText == 'with')?'without':'with'; wSol = !wSol; }
</script>
</body>
</html>
