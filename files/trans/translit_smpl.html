<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <title>PASTE</title>
    <style>
      :root {
        --ln: #cce;
        --fn: #999;
      }
      body { margin: 4px; }
      div {
        width: calc(100vw - 8px);
        height: calc(100vh - 8px);
        border: 1px solid var(--ln);
        overflow: auto;
        outline: none;
        user-select: none;
        cursor: pointer;
        box-sizing: border-box;
      }
      table {
        border-collapse: collapse;
        font: normal 14px monospace;
      }
      tr[cmp] {
        background-color: #fc9;
      }
      td {
        padding: 4px 6px;
        margin: 0;
        border-bottom: 1px solid var(--ln);
      }
      td:first-child {
        color: var(--fn);
        text-align: right;
        border-right: 1px solid var(--ln);
      }
      td:nth-child(5) {
        border-left: 1px solid var(--ln);
        padding-left: 12px;
      }
      span {
        font: italic 18px sans-serif;
        color: var(--fn);
        text-aling: center;
        margin: calc(100vh / 2 - 36px) 20% 0 20%;
        display: block;
      }
    </style>
  </head>
  <body>
    <div contenteditable="true">
      <span>Paste here the lists in Cyrillic and Latin/English transcription, in whatever order...</span>
      <table></table>
    </div>

  <script>

const Cmp = {
  cyr: null,
  lat: null
}

const Trans = [
['ья', '(ya|ia|iya)'],
['ье', '(ie|e|ye)'],
['ьи', '(yi|i)'],
['ай', '(ay|ai)'],
['ой', '(oy|oi)'],
['ий', '(iy|ii)'],
['уй', '(uy|ui)'],
['ый', '(yy|yi)'],
['эй', '(ey|yey)'],
['юй', '(yuy|yui)'],
['ей', '(ey|yey|ei)'],
['ия', '(ia|iya|ya)'],

['а','a'],['б','b'],['в','v'],['г','g'],['д','d'],
['е','e'],['ё','e'],['ж','zh'],['з','z'],['и','i'],
['й','i'],['к','k'],['л','l'],['м','m'],['н','n'],
['о','o'],['п','p'],['р','r'],['с','s'],['т','t'],
['у','u'],['ф','f'],['х','kh'],['ц','ts'],['ч','ch'],
['ш','sh'],['щ','shsh'],['ъ','ie'],['ы','y'],['ь',''],
['э','e'],['ю','yu'],['я','ya']
];

function dispatch() {
  if(!Cmp.cyr) makeTable(Cmp.lat.split('\n'));
  else if(!Cmp.lat) makeTable(Cmp.cyr.split('\n'));
  else process(Cmp.cyr.split('\n'), Cmp.lat.split('\n'));
}

var rmvSpan = true;

function makeTable(rs) {
  if(rmvSpan) {
    //document.querySelector('div').removeChild(document.querySelector('span'));
    document.querySelector('span').remove();
    rmvSpan = false;
  }
  let T = document.querySelector('table'), Cnt = 1;
  while(T.rows.length > 0) T.deleteRow(0);
  rs.forEach(r => {
    let R = T.insertRow(); if(r.charAt(0) == '>') {
      R.setAttribute('cmp','');
      r = r.substr(1);
    }
    let cs = r.split(' ');
    R.insertCell().innerText = Cnt++;
    cs.forEach(c => {
      let C = R.insertCell();
      C.innerText = c;
    });
  });
}

document.querySelector('div').addEventListener('paste', (event) => {
  let pst = (event.clipboardData || window.clipboardData).getData('text').trim();
  event.preventDefault();
  if(pst == '') return;
  if(/[а-я]/mgi.test(pst)) Cmp.cyr = pst; // is Cyrillic
  else Cmp.lat = pst;
  dispatch();
});

function process(cyr, lat) {
    lat = lat.map(el => el.trim());
    for(let i in cyr) {
      
      let w = cyr[i].trim().toLowerCase(); if(w == '') continue;
      if(w.charAt(0) == 'е' || w.charAt(0) == 'ё') w = "(ye|e)" + w.slice(1);
      let Rx = / (е|ё)/ig;
      if(Rx.test(w)) w = w.replace(Rx," (ye|e)");
      
      Trans.forEach(lit => { w = w.replaceAll(lit[0],lit[1]); });
      
      Rx = new RegExp('^'+ w + '$','i');

      let ix = lat.findIndex(val => Rx.test(val));
      if(ix < 0) cyr[i] = '>' + cyr[i] + '   ';
      else {
        cyr[i] += ' ' + lat[ix];
        lat[ix] = '>' + lat[ix];
      }
    }

    lat = lat.filter(el => el.charAt(0)!='>');
    lat = lat.map(el => '>   '+el);
    makeTable(cyr.concat(lat));
}
  </script>
  </body>
</html>
