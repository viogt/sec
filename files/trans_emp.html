<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <title>✍ Compare Transliteration</title>
    <style>
    * { box-sizing: border-box; }

    body { margin: 0; }
    .txt_area {
      width:33.3%;
      height:100vh;
      padding: 8px;
      display: inline-block;
      float:left;
      background-color: #eef;
    }
    textarea {
      padding: 8px 18px;
      font: normal 16px Arial,sans-serif;
      border: 1px dashed grey;
      border-radius: 8px;
      width: 100%;
      height: 100%;
      outline:none;
      resize: none;
      white-space: nowrap;
    }
    textarea::placeholder { font-size: 18px; font-style: italic; margin-right: 80px; }
    pre { display: none; }
    
    .fix_panel {
        position: fixed;
        top: 0px;
        height: 100vh;
        right: 0px;
        width: 120px;
        z-index: 100;
        text-align: center;
        overflow-y: scroll;
    }
    .fix_panel > span {
        width:80px;
        padding: 8px;
        border-radius: 12px;
        height: 94px;
        margin:0;
        text-align: center;
        margin-top: 20px;
        display: inline-block;
        font-size: 40px;
        cursor: pointer;
    }
    .fix_panel > span > label {
        display: block;
        font: normal 14px Arial,sans-serif;
        -webkit-user-select: none;
        -ms-user-select: none;
        user-select: none;
    }
    
    .pulse { animation: pulse-animation 1s 1; }
    @keyframes pulse-animation {
        0% { box-shadow: 0 0 0 0px rgba(200, 0, 0, 0.8); }
        100% { box-shadow: 0 0 0 20px rgba(200, 0, 0, 0); }
    }

    @media screen and (max-width: 800px) {
      .txt_area {
        width:100%;
        height:33.3vh;
      }
    }
    </style>
  </head>
<body>

<div class="fix_panel">
<span style="color:#060; background-color:rgba(60, 179, 113,.5)" onclick="sampleData(0)">
    <i class="fa fa-download"></i>
    <label>Sample data</label>
</span>
<span style="color:#800; background-color:rgba(220, 0, 0,.5)" onclick="matchTrans()">
    <i class="fa fa-check-circle"></i>
    <label>Check translit.</label>
</span>
<span style="color:#808; background-color:rgba(238, 130, 238,.5)" onclick="clearData()">
    <i class="fa fa-times-circle"></i>
    <label>Clear data</label>
</span>
<span style="color:#008; background-color:rgba(0, 0, 220,.5)" onclick="showMatch()">
    <i class="fa fa-info-circle"></i>
    <label>Show match</label>
</span>
<span style="color:#840; background-color:rgba(255, 165, 0,.5)" onclick="matchTrans(true)">
    <i class="fa fa-sort-alpha-asc"></i>
    <label>Sort the lists</label>
</span>
<span style="color:#066; background-color:rgba(0, 153, 153,.5)" onclick="sampleData(1)">
    <i class="fa fa-upload"></i>
    <label>Sample full data<small><sup>1</sup></small></label>
</span>
<span style="color:#b20; background-color:rgba(204, 51, 0,.5)" onclick="sampleData(2)">
    <i class="fa fa-cloud-upload"></i>
    <label>Sample full data<small><sup>2</sup></small></label>
</span>
<span style="color:#570; background-color:rgba(153, 204, 0,.5)" onclick="moreInfo()">
    <i class="fa fa-wrench"></i>
    <label>Translit. rules</label>
</span>
</div>

<pre id="pre_cyr">
Александр Васильевич Александров
Данила Илларионович Татаров
Елена Ивановна Николаева
Алексей Ильич Васнецов
Евгений Петрович Крылов
Кирилл Алексеевич Татаров
Анна Ивановна Селезнёва
Ксения Владимировна Иванова
Мариянна Петровна Ким
Изя Марковна Гинзбург
Сергей Ильич Васнецов
Никита Илларионович Крылов
Наталья Ивановна Николаева
Мария Владимировна Иванова
Андрей Алексеевич Татаров
Артём Петрович Крылов
Ольга Ивановна Селезнёва
Александра Петровна Иванова
Дмитрий Васильевич Александров
Иван Илларионович Серов
Светлана Петровна Николаева
Софья Владимировна Ким
Михаил Петрович Крылов
Пётр Ильич Васнецов
Юлия Ивановна Селезнёва
Дарья Владимировна Серова
Павел Васильевич Татаров
Магомед Каримович Дудаев
Егор Илларионович Александров
Мария Петровна Иванова
Анастассия Владимировна Николаева
Полина Владимировна Серова
Илья Алексеевич Крылов
Матвей Ильич Васнецов
Ирина Петровна Николаева
Елизавета Ивановна Иванова
Константин Илларионович Татаров
Максим Петрович Васнецов
Екатерина Петровна Иванова
Валерия Владимировна Николаева
Виктор Васильевич Крылов
Григорий Ильич Васнецов
Татьяна Ивановна Селезнёва
Екатерина Владимировна Ким
</pre>
<pre id="pre_lat">
Sofia Vladimirovna Kim
Mikhail Petrovich Krylov
Petr Ilyich Vasnetsov
Yulia Ivanovna Selezneva
Daria Vladimirovna Serova
Pavel Vasilievich Tatarov
Egor Illarionovich Aleksandrov
Maria Petrovna Ivanova
Polina Vladimirovna Serova
Ilya Alekseevich Krylov
Matvey Ilyich Vasnetsov
Aleksandr Vasilievich Aleksandrov
Danila Illarionovich Tatarov
Elena Ivanovna Nikolaeva
Anastasia Vladimirovna Nikolaeva
Aleksey Ilyich Vasnetsov
Yevgeniy Petrovich Krylov
Kirill Alekseevich Tatarov
Anna Ivanovna Selezneva
Ksenia Vladimirovna Ivanova
Maryanna Petrovna Kim
Sergei Ilyich Vasnetsov
Nikita Illarionovich Krylov
Ibrahim Ahmatovich Karamazin
Natalya Ivanovna Nikolaeva
Maria Vladimirovna Ivanova
Andrey Alekseevich Tatarov
Artem Petrovich Krylov
Irina Petrovna Nikolaeva
Elizaveta Ivanovna Ivanova
Konstantin Illarionovich Tatarov
Maksim Petrovich Vasnetsov
Ekaterina Petrovna Ivanova
Valeria Vladimirovna Nikolaeva
Viktor Vasilievich Krylov
Grigorii Ilyich Vasnetsov
Tatiana Ivanovna Selezneva
Ekaterina Vladimirovna Kim
Olga Ivanovna Selezneva
Aleksandra Petrovna Ivanova
Dmitriy Vasilievich Aleksandrov
Ivan Illarionovich Serov
Svetlana Petrovna Nikolaeva
</pre>
<div class='txt_area'><textarea id="cyr" placeholder="Paste here the List in Cyrillic..."></textarea></div>
<div class='txt_area'><textarea id="lat" placeholder="Paste here the transcripted List with Latin letters..."></textarea></div>
<div class='txt_area'><textarea id="unMatch" placeholder="The mismatched items will appear here..."></textarea></div>

<script>

const Trans = [
['ья', '(ya|ia|iya)'],
['ье', '(ie|e|ye)'],
['ьи', '(yi|i)'],
['ай', '(ay|ai)'],
['ой', '(oy|oi)'],
['ий', '(iy|ii)'],
['уй', '(uy|ui)'],
['ый', '(yy|yi)'],
['эй', '(ey|yey)'],
['юй', '(yuy|yui)'],
['ей', '(ey|yey|ei)'],
['ия', '(ia|iya|ya)'],

['а','a'],['б','b'],['в','v'],['г','g'],['д','d'],
['е','e'],['ё','e'],['ж','zh'],['з','z'],['и','i'],
['й','i'],['к','k'],['л','l'],['м','m'],['н','n'],
['о','o'],['п','p'],['р','r'],['с','s'],['т','t'],
['у','u'],['ф','f'],['х','kh'],['ц','ts'],['ч','ch'],
['ш','sh'],['щ','shsh'],['ъ','ie'],['ы','y'],['ь',''],
['э','e'],['ю','yu'],['я','ya']
];

    const Cyr = document.getElementById("cyr"),
          Lat = document.getElementById("lat"),
          unMatch = document.getElementById("unMatch");
    
    var _show = false;

function clearData() {
  Cyr.value = '';
  Lat.value = '';
  unMatch.value = '';
  unMatch.style.backgroundColor = '';
}

function sampleData(tip) {
try {
  Cyr.value = document.getElementById("pre_cyr").innerText.trim().split('\n').map(e => {
      if(tip==0) return e.split(' ')[0];
      if(tip==1) return e;
      return `${(e=e.split(' '))[2].toUpperCase()} ${e[0]} ${e[1]}`;
      
      //if(e.split(' ').length < 3) { alert(e); return 'XXXXXX'; }
      //return e.split(' ')[2].toUpperCase();
      //else return e.split(' ')[2].toUpperCase();
      //else { let x = e.split(' '); return `${x[2].toUpperCase()} ${x[0]} ${x[1]}`};
  }).join('\n');
  Lat.value = document.getElementById("pre_lat").innerText.trim().split('\n').map(e => {
      if(tip==0) return e.split(' ')[0];
      if(tip==1) return e;
      return `${(e=e.split(' '))[2].toUpperCase()} ${e[0]} ${e[1]}`;
      
      //if(e.split(' ').length < 3) { alert(e); return 'XXXXXX'; }
      //return e.split(' ')[2].toUpperCase();
      //else return e.split(' ')[2].toUpperCase();
      //else { let x = e.split(' '); return `${x[2].toUpperCase()} ${x[0]} ${x[1]}`};
  }).join('\n');
  unMatch.value = '';
  matchTrans();
} catch(e) { alert('ERROR: ' + e.message); }
}

function showMatch() {
    _show = !_show;
    matchTrans();
}

function matchTrans(_sort = false) {
try {
    let cr = Cyr.value.trim(), lt = Lat.value.trim();
    if(cr == '' || lt == '') return;

	let RxD = / → .+/gm;
    if(RxD.test(cr)) cr = cr.replace(RxD,'');
    if(cr.includes(" \n")) cr = cr.replace(/ +$/gm,'');
    if(RxD.test(lt)) lt = lt.replace(RxD,'');
    if(lt.includes(" \n")) lt = lt.replace(/ +$/gm,'');

    let cyr = cr.split('\n'),
        lat = lt.split('\n');
    
        lat = lat.map(el => el.trim());
    
    if(_sort) { cyr.sort(); lat.sort(); }

    for(let i in cyr) {
      
      let w = cyr[i].trim().toLowerCase(); if(w == '') continue;
      if(w.charAt(0) == 'е' || w.charAt(0) == 'ё') w = "(ye|e)" + w.slice(1);
      let Rx = / (е|ё)/ig;
      if(Rx.test(w)) w = w.replace(Rx," (ye|e)");
      
      Trans.forEach(lit => { w = w.replaceAll(lit[0],lit[1]); });
      
      Rx = new RegExp('^'+ w + '$','i');

      let ix = lat.findIndex(val => Rx.test(val));
      if(ix < 0) cyr[i] += ' → ?';
      else {
          if(_show) cyr[i] += ' → ' + lat[ix];
          lat[ix] = '+' + lat[ix];
      }
    }

    Cyr.value = cyr.join('\n');
    lat = lat.map(el => (el.charAt(0)=='+'?el.slice(1):el+' → ?'));
    Lat.value = lat.join('\n');
    
    Rx = / → \?$/;
    cr = cyr.filter(e=>Rx.test(e));
    lt = lat.filter(e=>Rx.test(e));
    unMatch.value  = `✍  MISMATCHED (${cr.length}/${cyr.length} Cyrillic):\n\n${cr.join('\n')}\n\n✍  MISMATCHED (${lt.length}/${lat.length} Transliterated):\n\n${lt.join('\n')}`;
    unMatch.style.backgroundColor = '#ffd';

} catch(e) { alert(e.message); }
}

function moreInfo() {
    unMatch.value += `${unMatch.value==''?'':'\n\n'}✍  TRANSLITERATION TABLE:\n\n${Trans.map(e => e.join(' → ')).join('\n')}\n\n- https://en.wikipedia.org/wiki/Romanization_of_Russian\n- http://transliteration.ru/mvd_1047/\n- https://enguide.ru/magazine/angliyskaya-transliteraciya-russkih-fio`;
}

document.querySelectorAll('span').forEach(e => e.addEventListener("click", function(e) {
    let el = e.target.tagName != 'SPAN' ? e.target.parentElement : e.target;
    el.classList.remove("pulse");
    void el.offsetWidth;
    el.classList.add("pulse");
    //navigator.vibrate(100);
}, false));

</script>
</body>
</html>
