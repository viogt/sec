<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
  <title>DIACRITICE</title>
  <style>
  * { box-sizing: border-box; }
  html, body {
      padding: 2px;
      max-width: 700px;
      margin: auto;
      height: 100%;
      background-color: #dde;
  }
  textarea {
    width: 100%;
    min-height: calc(100% - 28px);
    outline: none;
    resize: none;
    margin: 0;
    display: block;
    font: normal 15px Arial,sans-serif;
    padding: 8px;
  }
  button {
  	height: 28px;
    width: 100%;
    margin: 0;
    display: block;
    border: none;
    background-color: #779;
    color: #fff;
  }
@media screen and (max-width: 700px) {
  body { width:100%; }
}
  </style>
</head>
<body>

<textarea></textarea>
<button onclick='Diac()'>Clean the above text</button>
<div></div>

<script>
    
    const txt = document.querySelector("textarea");
    txt.focus();
    
    const PREF = ['neî','preî','desî','dezî','deî','străî','răsî','răzî','contraî','interî','antiî','supraî','postî','ultraî','arhiî','subî','inî','conî','comî','transî','hiperî','coî'];

    
    function Diac() {
        let T = txt.value.trim(), b = '', cnt = 0, corr = 0;

        //Diacriticie
        T = T.replace(/[ŞşŢţ]/g, x=>{ corr++; return "ȘșȚț".charAt("ŞşŢţ".indexOf(x)); });
        
    // every word
    T = T.replace(/[a-zăîșțâA-ZĂÎȘȚÂ]+/gm, x=>{

          cnt++;
          let w = x.toLowerCase();

          if(w == 'si') {
            corr++;
            b += x;
            x = (x.charAt(0)=='s'?'ș':'Ș') + x.charAt(1);
            b += ` -> ${x}\n`;
            return x;
          }
          if(w == 'in') {
            corr++;
            b += x;
            x = (x.charAt(0)=='i'?'î':'Î') + x.charAt(1);
            b += ` -> ${x}\n`;
            return x;
          }
          if(w=='sînt' || w=='sânt') {
            let y = x.charAt(1); y = (y=='î' || y=='â')?'u':'U';
            corr++;
            b += x;
            x = x.charAt(0) + y + x.slice(2);
            b += ` -> ${x}\n`;
            return x;
          }
          
          if(!w.includes('î')) return x;

          let pref = '', base = x, dezin = '';
          
          if(w.charAt(0) == 'î') {
            pref = x.charAt(0);
            base = base.slice(1);
          }
          else for(let p of PREF) {
            let pL = p.length;
            if(w.substr(0,pL) == p) {
              pref = x.substr(0,pL);
              base = base.slice(pL);
              break;
            }
          }
          if(w.slice(-1) == 'î') {
            dezin = 'î';
            base = base.substr(0,base.length - 1);
          }
          
          if(!base.includes('î') && !base.includes('Î')) return x;
          corr++;
          b += x;
          x = pref + base.replace(/î|Î/g, c => c=='î'?'â':'Â') + dezin;
          b += ` -> ${pref}|${base}|${dezin} -> ${x}\n`;

          return x;
    });
        
        // remove excessive \n
        T = T.replace(/ +(?=[.,:,?!\n )\]])/gm,'');
        T = T.replace(/(?<=\n) +/gm,'');

        // double \n
        T = T.replace(/(?<!\n)\n(?!\n)/gm,"\n\n");
        
        // correct quotation marks
        T = T.replace(/["'„”“‟](.+?)["'„”“‟]/gm, x => '„'+x.substr(1,x.length-2)+'”');

        document.querySelector("div").innerText =
        `Total words: ${cnt}, Corrections: ${corr}\n\n${b}`;
        
        txt.value = T;
        txt.select();
        document.execCommand('copy');
    }
</script>
</body>
</html>
