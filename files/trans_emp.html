<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <title>✍ Compare Transliteration</title>
    <style>
    * { box-sizing: border-box; }

    body { margin: 0; background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAcAAAAHCAYAAADEUlfTAAAAAXNSR0IArs4c6QAAADRJREFUGFdjZHDp+M+wp4IBG2BkYGD4z+DSwYBNAUQSBLAoQEhiUYAqiaYAUxJJAXZJqAIAflsTzeLXaHkAAAAASUVORK5CYII=) repeat; }
    .txt_area {
        position: absolute;
        padding: 5px;
        float:left;
    }
    textarea {
      padding: 8px 18px;
      font: normal 16px Arial,sans-serif;
      color: #aae;
      border: 1px solid #048;
      border-radius: 8px;
      margin: 5px;
      float: left;
      display: inline-block;
      outline:none;
      resize: none;
      white-space: pre;
    }
    .bk {
background-image: url("data:image/svg+xml,%3Csvg width='300' height='300' version='1.1' viewBox='0 0 79.4 79.4' xmlns='http://www.w3.org/2000/svg'%3E%3Cg transform='translate(0 -218)'%3E%3Cpath d='m0 297v-56.9s20.6-8.12 29.8-4.64c7.6 2.89 8.34 14.8 15.2 19.2 7.77 4.98 19.5 1.01 26.9 6.57 4.05 3.07 7.51 13.3 7.51 13.3v22.5z' fill='%23048'/%3E%3Cpath d='m0 265c33.9 3.52 49 15.2 52.9 31.8h-52.9z' fill='%23024'/%3E%3C/g%3E%3C/svg%3E");
background-repeat: no-repeat;
/*background-size: auto 100%;*/
    background-color: #224;
    }
    .x_bk {
background-image: url("data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='300' height='300' version='1.1' viewBox='0 0 79.4 79.4' xmlns='http://www.w3.org/2000/svg'%3E%3Cg transform='translate(0 -218)'%3E%3Cpath d='m0 297v-56.9s20.6-8.12 29.8-4.64c7.6 2.89 8.34 14.8 15.2 19.2 7.77 4.98 19.5 1.01 26.9 6.57 4.05 3.07 7.51 13.3 7.51 13.3v22.5z' fill='%23048'/%3E%3Cpath d='m0 265c33.9 3.52 49 15.2 52.9 31.8h-52.9z' fill='%23024'/%3E%3C/g%3E%3C/svg%3E%0A");
background-repeat: no-repeat;
    background-color: #224;
    }
    textarea::placeholder { font-size: 20px; font-style: italic; color: #06b; }
    pre { display: none; }
    
    .fix_panel {
        position: absolute;
        z-index: 100;
        font-family: Arial,sans-serif;
        padding: 5px;
        overflow: auto;
        white-space: nowrap;
    }
    .fix_panel > div {
        width: 60px; height: 60px;
        padding: 6px 0;
        border-radius: 9px;
        margin: 5px;
        text-align: center;
        display: inline-block;
        cursor: pointer;
        border: 1px solid #048;
        color: #06b;
        background-color: #224;
    }
    .fix_panel > div > i {
        font-size: 26px;
        display: block;
    }
    .fix_panel > div > label {
        display: block;
        font-size: 11px;
        -webkit-user-select: none;
        -ms-user-select: none;
        user-select: none;
    }

    .pregToast {
        font: normal 24px Arial, sans-serif;
        padding: 18px 24px;
        height: 60px;
        position: absolute;
    	left: calc(40vw - 90px);
        top: -60px;
        text-align: center;
        background-color: #002;
        color: #eef;
        border-radius: 6px;
        border: 1px solid #048;
        z-index: 103;
        transition: top .3s ease;
    }
    .spin {
        font-size: 140px;
        color: #008;
        position: absolute;
        z-index: 102;
        top: calc(100vh / 2 - 70px);
        left: calc(100vw / 2 - 70px);
        display: none;
    }
    .infoPad {
        font: normal 16px Arial, sans-serif;
        padding: 28px 28px;
        position: absolute;
        top: 0px; left: -100vw; height: 100vh; width: 100vw;
        background-color: rgb(0,0,0,0.85);
        color: #fff;
        z-index: 103;
        overflow: auto;
        transition: left .4s ease;
    }
    .infoPad a { color: #99f; }
    .infoPadTitle {
        font-size: 20px;
        color:#ffa;
        margin: 28px 0;
    }
    .cancelIcon {
        float: right;
        top: 0px; right: 0px;
        font-size: 34px; color: #fff;
        background-color: #600;
        width: 50px; height: 50px;
        padding-top: 8px;
        text-align: center;
        border-radius: 50%;
        cursor: pointer;
        position: sticky;
        box-shadow: 0 0 8px 3px #900 inset;
    }

    .pulse { animation: pulse-animation 1s 1; }
    @keyframes pulse-animation {
        0% { box-shadow: 0 0 0 0px rgba(200, 0, 0, 0.8); }
        100% { box-shadow: 0 0 0 10px rgba(200, 0, 0, 0); }
    }

    /*@media screen and (max-width: 800px) {
      .txt_area {
        width:100%;
        height:33.3vh;
      }
    }*/
    </style>
  </head>
<body onload="init(false)" onresize="init(false)">

<div class="fix_panel">
<div onclick="sampleData(0)">
    <i class="fa fa-download"></i>
    <label>Sample<br>data</label>
</div>
<div onclick="matchTrans()">
    <i class="fa fa-check-circle"></i>
    <label>Check<br>translit.</label>
</div>
<div onclick="clearData()">
    <i class="fa fa-times-circle"></i>
    <label>Clear<br>data</label>
</div>
<div onclick="showMatch()">
    <i class="fa fa-info-circle"></i>
    <label>Show<br>match</label>
</div>
<div onclick="matchTrans(true)">
    <i id="sortIcon" class="fa fa-sort-alpha-asc"></i>
    <label>Sort<br>the lists</label>
</div>
<div onclick="sampleData(1)">
    <i class="fa fa-upload"></i>
    <label>Sample<br>full data<small><sup>1</sup></small></label>
</div>
<div onclick="sampleData(2)">
    <i class="fa fa-cloud-upload"></i>
    <label>Sample<br>full data<small><sup>2</sup></small></label>
</div>
<div onclick="bigDataSim()">
    <i class="fa fa-archive"></i>
    <label>Simulate<br>big data<small><sup>3</sup></small></label>
</div>
<div onclick="init(true)">
    <i id="menuSize" class="fa fa-retweet"></i>
    <label>Menu<br>position</label>
</div>
<div onclick="uniqueSet(this)">
    <i class="fa fa-flag-checkered"></i>
    <label>Uniques<br>Set OFF</label>
</div>
<div onclick="duotone()">
    <i class="fa fa-adjust"></i>
    <label>Duotone<br>or colour</label>
</div>
<div onclick="moreInfo(true)">
    <i class="fa fa-wrench"></i>
    <label>Translit.<br>rules</label>
</div>
</div>

<pre id="pre_cyr">
Александр Васильевич Александров
Данила Илларионович Татаров
Елена Ивановна Николаева
Алексей Ильич Васнецов
Евгений Петрович Крылов
Кирилл Алексеевич Татаров
Анна Ивановна Селезнёва
Ксения Владимировна Иванова
Мариянна Петровна Ким
Изя Марковна Гинзбург
Сергей Ильич Васнецов
Никита Илларионович Крылов
Наталья Ивановна Николаева
Мария Владимировна Иванова
Андрей Алексеевич Татаров
Артём Петрович Крылов
Ольга Ивановна Селезнёва
Александра Петровна Иванова
Дмитрий Васильевич Александров
Иван Илларионович Серов
Светлана Петровна Николаева
Софья Владимировна Ким
Михаил Петрович Крылов
Пётр Ильич Васнецов
Юлия Ивановна Селезнёва
Дарья Владимировна Серова
Павел Васильевич Татаров
Магомед Каримович Дудаев
Егор Илларионович Александров
Мария Петровна Иванова
Анастассия Владимировна Николаева
Полина Владимировна Серова
Илья Алексеевич Крылов
Матвей Ильич Васнецов
Ирина Петровна Николаева
Елизавета Ивановна Иванова
Константин Илларионович Татаров
Максим Петрович Васнецов
Екатерина Петровна Иванова
Валерия Владимировна Николаева
Виктор Васильевич Крылов
Григорий Ильич Васнецов
Татьяна Ивановна Селезнёва
Екатерина Владимировна Ким
</pre>
<pre id="pre_lat">
Sofia Vladimirovna Kim
Mikhail Petrovich Krylov
Petr Ilyich Vasnetsov
Yulia Ivanovna Selezneva
Daria Vladimirovna Serova
Pavel Vasilievich Tatarov
Egor Illarionovich Aleksandrov
Maria Petrovna Ivanova
Polina Vladimirovna Serova
Ilya Alekseevich Krylov
Matvey Ilyich Vasnetsov
Aleksandr Vasilievich Aleksandrov
Danila Illarionovich Tatarov
Elena Ivanovna Nikolaeva
Anastasia Vladimirovna Nikolaeva
Aleksey Ilyich Vasnetsov
Yevgeniy Petrovich Krylov
Kirill Alekseevich Tatarov
Anna Ivanovna Selezneva
Ksenia Vladimirovna Ivanova
Maryanna Petrovna Kim
Sergei Ilyich Vasnetsov
Nikita Illarionovich Krylov
Ibrahim Ahmatovich Karamazin
Natalya Ivanovna Nikolaeva
Maria Vladimirovna Ivanova
Andrey Alekseevich Tatarov
Artem Petrovich Krylov
Irina Petrovna Nikolaeva
Elizaveta Ivanovna Ivanova
Konstantin Illarionovich Tatarov
Maksim Petrovich Vasnetsov
Ekaterina Petrovna Ivanova
Valeria Vladimirovna Nikolaeva
Viktor Vasilievich Krylov
Grigorii Ilyich Vasnetsov
Tatiana Ivanovna Selezneva
Ekaterina Vladimirovna Kim
Olga Ivanovna Selezneva
Aleksandra Petrovna Ivanova
Dmitriy Vasilievich Aleksandrov
Ivan Illarionovich Serov
Svetlana Petrovna Nikolaeva
</pre>
<div class='txt_area'>
    <textarea class="bk" id="cyr" placeholder="Paste Cyrillic here"></textarea>
    <textarea class="bk" id="lat" placeholder="Paste transcript here"></textarea>
    <textarea class="x_bk" id="unMatch" readonly placeholder="Mismatched result"></textarea>
</div>
<div class='pregToast'><i class="fa fa-exclamation-triangle"></i>&nbsp;&nbsp;<span></span></div>
<!-- <div class='infoPad'>
    <i class="fa fa-times cancelIcon" onclick="moreInfo(false)"></i>
    <div class="infoPadTitle"><big><i class="fa fa-wrench"></i></big>&nbsp;&nbsp;Translit. rules:</div>
    <code></code>
    <div class="infoPadTitle"><big><i class="fa fa-info-circle"></i></big>&nbsp;&nbsp;Useful links:</div>
    <ul>
        <li><a target="_blank" href="https://en.wikipedia.org/wiki/Romanization_of_Russian">https://en.wikipedia.org/wiki/Romanization_of_Russian</a></li>
        <li><a target="_blank" href="http://transliteration.ru/mvd_1047/">http://transliteration.ru/mvd_1047/</a></li>
        <li><a target="_blank" href="https://enguide.ru/magazine/angliyskaya-transliteraciya-russkih-fio">https://enguide.ru/magazine/angliyskaya-transliteraciya-russkih-fio</a></li>
    </ul>
</div> -->

<i class="spin fa fa-spinner fa-pulse"></i>
<script>

const Trans = [
['ья', '(ya|ia|iya)'],
['ье', '(ie|e|ye)'],
['ьи', '(yi|i)'],
['ай', '(ay|ai)'],
['ой', '(oy|oi)'],
['ий', '(iy|ii)'],
['уй', '(uy|ui)'],
['ый', '(yy|yi)'],
['эй', '(ey|yey)'],
['юй', '(yuy|yui)'],
['ей', '(ey|yey|ei)'],
['ия', '(ia|iya|ya)'],

['а','a'],['б','b'],['в','v'],['г','g'],['д','d'],
['е','e'],['ё','e'],['ж','zh'],['з','z'],['и','i'],
['й','i'],['к','k'],['л','l'],['м','m'],['н','n'],
['о','o'],['п','p'],['р','r'],['с','s'],['т','t'],
['у','u'],['ф','f'],['х','kh'],['ц','ts'],['ч','ch'],
['ш','sh'],['щ','shsh'],['ъ','ie'],['ы','y'],['ь',''],
['э','e'],['ю','yu'],['я','ya']
];

    const Cyr = document.getElementById("cyr"),
          Lat = document.getElementById("lat"),
          unMatch = document.getElementById("unMatch");
    
    var _show = false, _srtPrfm = true, _unique = false;

function notEmpty(ob) { return /\S/mg.test(ob.value); }

var menuPos = 0;
function init(fl) {
try {
    const   pnl = document.querySelector(".fix_panel"),
            Bd = document.querySelector('.txt_area');
   
    let tW = screen.width || window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth,
    tH = screen.height || window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight,
    txW, txH, s;
    
    if(fl) menuPos = menuPos < 3 ? menuPos+1 : 0;
    
    if(menuPos == 0 || menuPos == 2) {
        s = pnl.style;
        s.whiteSpace="nowrap";
        s.left = '0px';
        s.height = '80px'; s.width = `${tW}px`;
        s = Bd.style;
        s.left = '0px';
        s.height = `${tH - 70}px`; s.width = `${tW}px`;
        
        txH = (tH-110)/3; txW = tW-20;
        
        if(menuPos == 0) { pnl.style.top = '0px'; Bd.style.top = '70px'; }
        else { pnl.style.top = `${tH - 80}px`; Bd.style.top = '0px'; }
    }
    else {
        s = pnl.style;
        s.whiteSpace="normal";
        s.top = '0px';
        s.height = `${tH}px`; s.width = '80px';
        s = Bd.style;
        s.top = '0px';
        s.height = `${tH}px`; s.width = `${tW-80}px`;
        
        txH = (tH-40)/3; txW = tW-90;
        
        if(menuPos == 1) { pnl.style.left = `${tW-80}px`; Bd.style.left = '0px'; }
        else { pnl.style.left = '0px'; Bd.style.left = '70px'; }
    }
  
    Bd.querySelectorAll("textarea").forEach(e => {
        e.style.height = `${txH}px`;
        e.style.width = `${txW}px`;
    });
} catch(er) { alert(er.message); }  
}

function clearData() {
  Cyr.value = '';
  Lat.value = '';
  unMatch.value = '';
  setSortIcon();
}

function sampleData(tip) {
  Cyr.value = document.getElementById("pre_cyr").innerText.trim().split('\n').map(e => {
      if(tip==0) return e.split(' ')[0];
      if(tip==1) return e;
      return `${(e=e.split(' '))[2].toUpperCase()} ${e[0]} ${e[1]}`;
  }).join('\n');
  Lat.value = document.getElementById("pre_lat").innerText.trim().split('\n').map(e => {
      if(tip==0) return e.split(' ')[0];
      if(tip==1) return e;
      return `${(e=e.split(' '))[2].toUpperCase()} ${e[0]} ${e[1]}`;
  }).join('\n');
  unMatch.value = '';
  setSortIcon();
  matchTrans();
}

function bigDataSim() {
    let Qt = prompt("Please enter the number of persons:", "4000");
    if(Qt == null || isNaN(Qt) || Qt < 1) { preToggleToast('CANCEL',600); return; }
    if(Qt < 300) preToggleToast(`${Qt} rcs`,800);

    let Cr = document.getElementById("pre_cyr").innerText.trim().split('\n'),
        Lt = document.getElementById("pre_lat").innerText.trim().split('\n');
    let CR = [], LT = [], L = Math.min(Cr.length,Lt.length);
    
    while(Qt > 0) {
        CR = CR.concat(Cr.slice(0, Math.min(L,Qt)));
        LT = LT.concat(Lt.slice(0, Math.min(L,Qt)));
        Qt -= L;
    }
    Cyr.value = CR.join('\n');
    Lat.value = LT.join('\n');
    unMatch.value = '';
    setSortIcon();
    matchTrans();
}

function showMatch() {
    _show = !_show;
    preToggleToast(`Show ${_show?'ON':'OFF'}`,800);
    matchTrans();
}

function matchTrans(_sort = false) {
    /*let cr = Cyr.value.trim(), lt = Lat.value.trim(); // empty
    if(cr == '' || lt == '') { preToggleToast('EMPTY',600); return; }*/
    if(!notEmpty(Cyr) || !notEmpty(Lat)) { preToggleToast('EMPTY',600); return; }
    if((Cyr.value.match(/\n/mg) || []).length > 300) {
        spinOn(true);
        setTimeout(()=>{ matchProc(_sort,true); },0);
    }
    else matchProc(_sort,false);
}

function matchProc(_sort = false, _spin) {
try {
    let cr = Cyr.value.trim(), lt = Lat.value.trim();
    if(cr == '' || lt == '') { preToggleToast('EMPTY',600); return; }

	let RxD = / → .+/gm;
    if(RxD.test(cr)) cr = cr.replace(RxD,'');
    if(cr.includes(" \n")) cr = cr.replace(/ +$/gm,'');
    if(RxD.test(lt)) lt = lt.replace(RxD,'');
    if(lt.includes(" \n")) lt = lt.replace(/ +$/gm,'');

    let cyr = cr.split('\n'),
        lat = lt.split('\n');

        lat = lat.map(el => el.trim());
    
    if(_unique) { cyr = [...new Set(cyr)]; lat = [...new Set(lat)]; }
    
    if(_sort) {
        if(_srtPrfm) { cyr.sort(); lat.sort(); _srtPrfm = false; }
        else {
            cyr.reverse(); lat.reverse();
            let i = document.getElementById("sortIcon").classList;
            i.toggle('fa-sort-alpha-asc'); i.toggle('fa-sort-alpha-desc');
        }
    }

    for(let i in cyr) {
      
      let w = cyr[i].trim().toLowerCase(); if(w == '') continue;
      if(w.charAt(0) == 'е' || w.charAt(0) == 'ё') w = "(ye|e)" + w.slice(1);
      let Rx = / (е|ё)/ig;
      if(Rx.test(w)) w = w.replace(Rx," (ye|e)");
      
      Trans.forEach(lit => { w = w.replaceAll(lit[0],lit[1]); });
      
      Rx = new RegExp('^'+ w + '$','i');

      let ix = lat.findIndex(val => Rx.test(val));
      if(ix < 0) cyr[i] += ' → ?';
      else {
          if(_show) cyr[i] += ' → ' + lat[ix];
          lat[ix] = '+' + lat[ix];
      }
    }

    Cyr.value = cyr.join('\n');
    lat = lat.map(el => (el.charAt(0)=='+'?el.slice(1):el+' → ?'));
    Lat.value = lat.join('\n');
    
    unMatch.style.backgroundColor = '#448';
    setTimeout(()=>{ unMatch.style.backgroundColor = ''; }, 400);
    
    Rx = / → \?$/;
    cr = cyr.filter(e=>Rx.test(e));
    lt = lat.filter(e=>Rx.test(e));
    unMatch.value  = `✍  MISMATCHED (${cr.length}/${cyr.length} Cyrillic):\n\n${cr.join('\n')}\n\n✍  MISMATCHED (${lt.length}/${lat.length} Transliterated):\n\n${lt.join('\n')}`;
    if(_spin) spinOn(false);

} catch(e) { alert("ERROR: " + e.message); }
}

function moreInfo(fl) {
    let el = document.querySelector('.infoPad');
    el.querySelector('code').innerText = Trans.map(e => e.join(' → ')).join('\n');
    el.style.left = fl?'0px': `-${window.innerWidth}px`;
}

function spinOn(fl) {
    let s = document.querySelector('.spin').style;
    s.display = fl?'block':'none';
}

function preToggleToast(txt, ms) {
	let T = document.querySelector('.pregToast');
	if(ms) {
	    T.querySelector('span').innerText = txt;
	    T.style.top = '120px';
	}
	else T.style.top = '-60px';
	if(ms) setTimeout( function() { preToggleToast(null, 0); }, ms);
}

document.querySelectorAll('div').forEach(e => e.addEventListener("click", function(e) {
    let el = e.target.tagName != 'div' ? e.target.parentElement : e.target;
    el.classList.remove("pulse");
    void el.offsetWidth;
    el.classList.add("pulse");
    //navigator.vibrate(100);
}, false));

function setInp() {
    unMatch.value = '';
    setSortIcon();
    //if(Cyr.value.trim() !='' && Lat.value.trim() !='') {
    if(notEmpty(Cyr) && notEmpty(Lat)) {
        const rusPat = /[а-я]/mgi;
        if(!rusPat.test(Cyr.value)) { preToggleToast('Not Cyrillic',600); Cyr.value = ''; return; }
        if(rusPat.test(Lat.value)) { preToggleToast('Not Latin',600); Lat.value = ''; return; }
        matchTrans();
    }
}
Cyr.addEventListener('input', setInp);
Lat.addEventListener('input', setInp);

function setSortIcon() {
    _srtPrfm = true;
    let i = document.getElementById("sortIcon").classList;
    i.remove('fa-sort-alpha-asc','fa-sort-alpha-desc');
    i.add('fa-sort-alpha-asc');
}

function uniqueSet(el) {
    const sp = el.querySelector('label');
    _unique = !_unique; //sp.slice(-3) == 'OFF'?true:false;
    sp.innerHTML = `Uniques<br>Set ${_unique?'ON':'OFF'}`;
    preToggleToast(`Unique ${_unique?'ON':'OFF'}`,800);
}

var duoCurr = 0, duoArr = [];
function duotone() {
    duoCurr++; if(duoCurr > 2) duoCurr = 0;
    const duoEls = document.querySelector(".fix_panel").querySelectorAll('div');
    if(duoCurr == 0) {
        duoEls.forEach((e,i) => { e.style.color = duoArr[i][0]; e.style.backgroundColor = duoArr[i][1]; });
    }
    else if(duoCurr == 1) {
        if(duoArr.length < 1) duoEls.forEach(e => { duoArr.push([e.style.color, e.style.backgroundColor]); });
        duoEls.forEach(e => { e.style.color = "#224"; e.style.backgroundColor = "#06b"; e.style.border = "1px solid #000"; });
    }
    else {
        duoEls.forEach(e => { e.style.color = "#fff"; e.style.backgroundColor = "#06b"; e.style.border = "none"; });        
    }
}
</script>
</body>
</html>
